import{k as u,G as T,o as Y,K as n,T as ee,m,n as _,p as s,u as r,w as b,q as te,Z as oe,s as e,t as k,v as y,z as $,A as se,x as z,y as A,B as E,D as ae,C as N,O as re}from"./vendor9df2f612.js";import{_ as le}from"./AuthenticatedLayouta4b2ee4f.js";import{Q as de,Z as P}from"./flowbite-vue17772b29.js";import{S as ne}from"./sweetalert2.all2e5f4a54.js";import{_ as ce}from"./StockColor17b58de9.js";import{s as ie}from"./multiselectf73eb494.js";import{D as C,l as ue}from"./es-ESfe29d7f2.js";import{_ as ge}from"./PrimaryButton0ecc7f29.js";import{_ as x}from"./InputError36fdb8dd.js";import{_ as c}from"./InputLabel7da40d8f.js";import{_ as i}from"./TextInputaca9d9c1.js";import pe from"./CrearClientExternoc2041f68.js";import me from"./AgregarDescuentoModald2ed1d01.js";import"./Modale28fe8ea.js";import"./es.es96ee115e.js";const _e={class:"ml-4 col-span-full"},be={class:"p-4 mb-4 col-span-12 md:col-span-12 lg:col-span-6 bg-white rounded-lg border-gray-700 shadow dark:bg-gray-800 dark:border-gray-800 2xl:col-span-6 sm:p-4"},xe=["onSubmit"],ye={class:"px-2 grid grid-cols-12 gap-2 lg:gap-2 mt-0 mb-2"},fe={class:"grid grid-cols-12 gap-2 col-span-full lg:gap-2 mt-5"},ve={class:"col-span-8 lg:col-span-9"},he={class:"col-span-4 lg:col-span-3"},ke={class:"grid grid-cols-12 gap-2 mt-0 col-span-full"},we={class:"col-span-8 lg:col-span-9"},Ve={class:"col-span-4 lg:col-span-3 flex items-end mb-0.5 justify-end"},je={class:"grid grid-cols-12 mt-2 col-span-12 text-center"},Fe={class:"col-span-3 lg:col-span-6"},Ce={class:"col-span-3 lg:col-span-2"},Se={class:"col-span-3 lg:col-span-2"},Ue={class:"col-span-3 lg:col-span-2"},De={class:"col-span-3 lg:col-span-6"},Te={class:"flex"},$e={class:"rounded-none rounded-l inline-flex justify-center bg-red-600 text-base font-semibold text-white hover:bg-red-700"},ze=["onClick"],Ae=e("i",{class:"fas fa-times"},null,-1),Ee=[Ae],Ne={class:"col-span-3 lg:col-span-2"},Pe={class:"flex"},Be={class:"col-span-3 lg:col-span-2"},Ie={class:"flex"},Oe={class:"col-span-3 lg:col-span-2"},Me={class:"flex"},Ze={class:"col-span-12 lg:col-span-12"},Ge={key:0,class:"grid grid-cols-12 gap-2 mt-0 col-span-12 lg:col-span-6 items-center"},Le=e("div",{class:"col-span-12 lg:col-span-4"},null,-1),Qe={class:"col-span-12 lg:col-span-3"},qe={class:"col-span-12 lg:col-span-2"},Ke={class:"flex"},He=e("span",{class:"inline-flex w-6 justify-center items-center px-2 text-xs text-gray-900 bg-gray-200 border border-l-0 border-gray-300 rounded-r-md dark:bg-gray-600 dark:text-gray-400 dark:border-gray-600"},[e("i",{class:"fas fa-percentage"})],-1),Je={class:"col-span-12 lg:col-span-3"},Re={class:"flex"},We=e("span",{class:"inline-flex w-6 justify-center items-center px-2 text-xs text-gray-900 bg-gray-200 border border-r-0 border-gray-300 rounded-l-md dark:bg-gray-600 dark:text-gray-400 dark:border-gray-600"},[e("i",{class:"fas fa-dollar-sign"})],-1),Xe={class:"grid grid-cols-12 gap-2 mt-0 col-span-full"},Ye={class:"col-span-12 lg:col-span-5 flex justify-start items-end"},et={class:"col-span-6 lg:col-span-4 flex justify-end items-end"},tt={class:"col-span-6 lg:col-span-3"},ot={class:"flex"},st=e("span",{class:"inline-flex w-6 justify-center items-center px-2 text-xs text-gray-900 bg-gray-200 border border-r-0 border-gray-300 rounded-l-md dark:bg-gray-600 dark:text-gray-400 dark:border-gray-600"},[e("i",{class:"fas fa-dollar-sign"})],-1),at={class:"flex justify-end pt-5"},rt={class:"p-4 mb-4 col-span-12 md:col-span-12 lg:col-span-6 bg-white rounded-lg border-gray-700 shadow dark:bg-gray-800 dark:border-gray-800 2xl:col-span-6 sm:p-4"},lt={class:"overflow-x-auto"},dt={class:""},nt={class:"overflow-auto"},ct={id:"tabla1",class:"pt-4 w-full text-xs text-center text-gray-600 dark:text-gray-400"},it=e("thead",{class:"text-md text-center text-gray-700 bg-gray-200/80 dark:bg-gray-700 dark:text-gray-400"},[e("tr",null,[e("th",{scope:"col",class:"border border-gray-300 dark:border-gray-500 w-8 p-0"},[e("div",{class:"flex justify-center text-center"}," Imagen ")]),e("th",{scope:"col",class:"border border-gray-300 dark:border-gray-500"},[e("div",{class:"flex justify-center text-center"}," Nombre ")]),e("th",{scope:"col",class:"border border-gray-300 dark:border-gray-500 w-8"},[e("div",{class:"flex justify-center"}," Código ")]),e("th",{scope:"col",class:"p-0 m-0 border border-gray-300 dark:border-gray-500 w-8"},[e("div",{class:"flex justify-center"}," Stock ")]),e("th",{scope:"col",class:"border border-gray-300 dark:border-gray-500 w-10"},[e("div",{class:"flex justify-center"}," Acciones ")])])],-1),ut={scope:"row",class:"p-0 m-0 border dark:border-gray-700"},gt={class:"flex justify-center"},pt=["src"],mt={scope:"row",class:"p-1 border dark:bg-gray-800 dark:border-gray-700 font-medium text-gray-900 dark:text-white"},_t={scope:"row",class:"p-1 border dark:border-gray-700"},bt={scope:"row",class:"p-1 border dark:border-gray-700"},xt={scope:"row",class:"p-1 border dark:border-gray-700"},yt=["onClick","disabled"],S="Editar Cotización",It={__name:"Edit",setup(ft){C.use(C);const w=u([]),B=u(null),g=u(""),V=u([]),I={responsive:!1,language:ue},O=()=>{te(()=>{B.value=new C("#tabla1",I)})},M=()=>{},Z=l=>{t.porcentaje_descuento=l,v(),f(),j()},f=()=>{t.descuento=(t.porcentaje_descuento*t.total/100).toFixed(2),t.total=(t.total-t.descuento).toFixed(2)},G=T(()=>n().props.clientes),L=T(()=>n().props.cotizacion.codigo);u({value:"",closeOnSelect:!0,placeholder:"Seleccione",searchable:!1,options:[{value:"Contado",label:"Contado"},{value:"Abono",label:"Abono"},{value:"Domicilio",label:"Domicilio"}]}),Y(()=>{let l=n().props.cotizacion;U.value.options=G,R.value.options=n().props.metodos_pago,V.value=n().props.lista_clientes,w.value=n().props.productos.data,t.vendedor=n().props.vendedor,t.user_id=l.user_id,t.cliente_id=l.cliente_id,t.codigo=L,t.tipo_venta=l.tipo_venta,t.porcentaje_descuento=l.porcentaje_descuento,t.descuento=l.descuento,t.id=l.id,t.productos=n().props.detalle_productos,t.metodos_pago=n().props.detalle_pagos,t.total=parseFloat(l.total).toFixed(2);var o=V.value.find(a=>a.id===l.cliente_id);g.value=o.tipo_cliente,O()});const t=ee({id:"",vendedor:"",user_id:"",codigo:"",neto:"",cliente_id:"",porcentaje_descuento:"",descuento:"0",metodos_pago:[{metodo_pago_id:"",monto:"",tarjeta:""}],productos:[],saldo:"0",total:"0",tipo_venta:"Contado"}),Q=(l,o)=>{if(l.target.value>0)t.productos[o].stock>=t.productos[o].cantidad?(t.productos[o].total=(parseFloat(t.productos[o].cantidad)*parseFloat(t.productos[o].precio)).toFixed(2),v(),f()):(t.productos[o].cantidad=1,t.productos[o].total=(parseFloat(t.productos[o].cantidad)*parseFloat(t.productos[o].precio)).toFixed(2),F("La cantidad supera el Stock","error"));else return},v=()=>{t.neto=t.productos.reduce((l,o)=>l+parseFloat(o.total),0).toFixed(2),t.total=t.productos.reduce((l,o)=>l+parseFloat(o.total),0).toFixed(2)},j=()=>{t.suma_pago=t.metodos_pago.reduce((l,o)=>l+parseFloat(o.monto),0).toFixed(2),t.saldo=(t.total-t.suma_pago).toFixed(2)},q=l=>{g.value="",t.reset("metodos_pago","productos","total","porcentaje_descuento","porcentaje","saldo","suma_pago");var o=V.value.find(a=>a.id===l);g.value=o.tipo_cliente},K=()=>{g.value="",t.reset("metodos_pago","productos","total")},H=l=>{if(g.value!=""){var o=w.value.find(p=>p.id===l);if(o.stock>0){var a=g.value=="Minorista"?o.precio_venta:o.precio_mayorista;t.productos.push({producto_id:o.id,nombre:o.nombre,cantidad:1,stock:o.stock,precio:a.toFixed(2),total:a.toFixed(2)}),v(),f(),j()}else F("No hay stock disponible","error")}else F("Seleccione el cliente antes de agregar producto","error")},J=l=>{t.productos.splice(l,1),v(),f(),j()},U=u({value:"",closeOnSelect:!0,placeholder:"Seleccione",searchable:!0,options:[]}),F=(l,o)=>{ne.fire({width:350,title:l,icon:o})},R=u({value:"",closeOnSelect:!0,placeholder:"Seleccione",searchable:!1,options:[]});u("");const W=()=>{t.clearErrors(),t.post(route("cotizaciones.update",t.id),{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{re.get(route("cotizaciones.index")),t.reset("metodos_pago","productos","total","porcentaje_descuento","porcentaje","saldo","suma_pago")},onFinish:()=>{},onError:()=>{}})};return(l,o)=>(m(),_("div",null,[s(r(oe),{title:S}),s(le,null,{default:b(()=>[e("div",_e,[s(r(de),null,{default:b(()=>[s(r(P),{href:"/",home:""},{default:b(()=>[k(" Inicio ")]),_:1}),s(r(P),null,{default:b(()=>[k(y(S))]),_:1})]),_:1})]),e("div",be,[e("div",{class:"px-5 col-span-full flex justify-center items-center"},[e("h1",{class:"text-xl font-semibold text-gray-900 sm:text-2xl dark:text-white"},y(S))]),e("form",{onSubmit:$(W,["prevent"])},[e("div",ye,[e("div",fe,[e("div",ve,[s(c,{for:"vendedor",value:"Usuario",class:"block text-base font-medium leading-6 text-gray-900"}),s(i,{id:"vendedor",type:"text",class:"rounded bg-gray-50 border border-gray-300 text-gray-900 min-w-0 w-full text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white font-bold disabled:bg-gray-200",modelValue:r(t).vendedor,"onUpdate:modelValue":o[0]||(o[0]=a=>r(t).vendedor=a),disabled:""},null,8,["modelValue"]),s(x,{class:"mt-1 text-xs w-full",message:r(t).errors.vendedor},null,8,["message"])]),e("div",he,[s(c,{for:"codigo",value:"Código",class:"block text-base font-medium leading-6 text-gray-900"}),s(i,{id:"codigo",type:"text",class:"rounded bg-gray-50 border border-gray-300 text-gray-900 min-w-0 w-full text-sm dark:bg-gray-700 dark:border-gray-600 text-center dark:text-white font-bold disabled:bg-gray-200",modelValue:r(t).codigo,"onUpdate:modelValue":o[1]||(o[1]=a=>r(t).codigo=a),disabled:""},null,8,["modelValue"]),s(x,{class:"mt-1 text-xs w-full",message:r(t).errors.codigo},null,8,["message"])])]),e("div",ke,[e("div",we,[s(c,{for:"cliente_id",value:"Cliente -- "+g.value,class:"block text-base font-medium leading-6 text-gray-900"},null,8,["value"]),s(r(ie),se({id:"cliente_id",modelValue:r(t).cliente_id,"onUpdate:modelValue":o[2]||(o[2]=a=>r(t).cliente_id=a)},U.value,{onClear:K,onSelect:q}),null,16,["modelValue"]),s(x,{class:"mt-1 text-xs",message:r(t).errors.cliente_id},null,8,["message"])]),e("div",Ve,[s(pe,{onCreado:M})])]),e("div",je,[e("div",Fe,[s(c,{value:"Item",class:"m-0 text-md font-medium leading-6 text-gray-900"})]),e("div",Ce,[s(c,{value:"Precio",class:"m-0 text-md font-medium leading-6 text-gray-900"})]),e("div",Se,[s(c,{value:"Cantidad",class:"m-0 text-md font-medium leading-6 text-gray-900"})]),e("div",Ue,[s(c,{value:"Subtotal",class:"m-0 text-md font-medium leading-6 text-gray-900"})])]),(m(!0),_(z,null,A(r(t).productos,(a,p)=>(m(),_("div",{key:p,class:"grid grid-cols-12 gap-2 col-span-full"},[e("div",De,[e("div",Te,[e("span",$e,[e("button",{onClick:$(d=>J(p),["prevent"]),class:"w-6"},Ee,8,ze)]),s(i,{disabled:"",class:"rounded-none rounded-r bg-gray-50 border border-gray-300 text-gray-900 min-w-0 w-full text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white disabled:bg-gray-200",type:"text",modelValue:a.nombre,"onUpdate:modelValue":d=>a.nombre=d},null,8,["modelValue","onUpdate:modelValue"])])]),e("div",Ne,[e("div",Pe,[s(i,{disabled:"",class:"rounded text-end text-xs bg-gray-50 border border-gray-300 text-gray-900 min-w-0 w-full text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white disabled:bg-gray-200",type:"text",modelValue:a.precio,"onUpdate:modelValue":d=>a.precio=d},null,8,["modelValue","onUpdate:modelValue"])])]),e("div",Be,[e("div",Ie,[s(i,{class:"rounded text-end bg-gray-50 border border-gray-300 text-gray-900 min-w-0 w-full text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white",type:"number",min:"1",step:"1",modelValue:a.cantidad,"onUpdate:modelValue":d=>a.cantidad=d,onInput:d=>Q(d,p)},null,8,["modelValue","onUpdate:modelValue","onInput"])])]),e("div",Oe,[e("div",Me,[s(i,{disabled:"",class:"rounded text-end bg-gray-50 text-xs border border-gray-300 text-gray-900 min-w-0 w-full text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white disabled:bg-gray-200",type:"text",modelValue:a.total,"onUpdate:modelValue":d=>a.total=d},null,8,["modelValue","onUpdate:modelValue"])])])]))),128)),e("div",Ze,[s(x,{class:"mt-1 text-xs w-full",message:r(t).errors.productos},null,8,["message"])]),r(t).porcentaje_descuento>0?(m(),_("div",Ge,[Le,e("div",Qe,[s(c,{for:"descuento",value:"Descuento",class:"block text-base text-end font-normal leading-6 text-gray-900"})]),e("div",qe,[e("div",Ke,[s(i,{disabled:"",class:"rounded-none rounded-l bg-gray-50 border border-gray-300 text-gray-900 disabled:bg-gray-200 text-end min-w-0 w-full text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white",type:"text",modelValue:r(t).porcentaje_descuento,"onUpdate:modelValue":o[3]||(o[3]=a=>r(t).porcentaje_descuento=a)},null,8,["modelValue"]),He])]),e("div",Je,[e("div",Re,[We,s(i,{disabled:"",class:"rounded-none text-end rounded-r bg-gray-50 border border-gray-300 text-gray-900 min-w-0 w-full text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white disabled:bg-gray-200",type:"number",modelValue:r(t).descuento,"onUpdate:modelValue":o[4]||(o[4]=a=>r(t).descuento=a)},null,8,["modelValue"])]),s(x,{class:"mt-1 text-xs w-full",message:r(t).errors.descuento},null,8,["message"])])])):E("",!0),e("div",Xe,[e("div",Ye,[r(t).total>0?(m(),ae(me,{key:0,onValDescuento:Z})):E("",!0)]),e("div",et,[s(c,{for:"total",value:"Total a pagar",class:"block text-base font-normal leading-6 text-gray-900"})]),e("div",tt,[e("div",ot,[st,s(i,{disabled:"",class:"rounded-none text-end rounded-r bg-gray-50 border border-gray-300 text-gray-900 min-w-0 w-full text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white disabled:bg-gray-200",type:"number",modelValue:r(t).total,"onUpdate:modelValue":o[5]||(o[5]=a=>r(t).total=a)},null,8,["modelValue"])]),s(x,{class:"mt-1 text-xs w-full",message:r(t).errors.total},null,8,["message"])])])]),e("div",at,[s(ge,{class:N(["inline-block rounded bg-blue-600 p-2 text-sm font-semibold text-white mr-1 mb-1 hover:bg-blue-700",{"opacity-50":r(t).processing}]),disabled:r(t).processing},{default:b(()=>[k(" Guardar Cotización ")]),_:1},8,["class","disabled"])])],40,xe)]),e("div",rt,[e("div",lt,[e("div",dt,[e("div",nt,[e("table",ct,[it,e("tbody",null,[(m(!0),_(z,null,A(w.value,({id:a,nombre:p,imagen_1:d,codigo:X,stock:D,precio_compra:vt,precio_venta:ht,precio_mayorista:kt},wt)=>(m(),_("tr",{key:a,class:"bg-white text-center dark:bg-gray-800 dark:border-gray-700"},[e("td",ut,[e("div",gt,[e("img",{class:"rounded shadow-2xl border-2 w-12 h-12 object-contain",src:d,alt:"image description"},null,8,pt)])]),e("th",mt,y(p),1),e("td",_t,y(X),1),e("td",bt,[s(ce,{cantidad:D},{default:b(()=>[k(y(D),1)]),_:2},1032,["cantidad"])]),e("td",xt,[e("span",{class:N([r(t).productos.filter(h=>h.producto_id===a).length>0?"bg-blue-400":" bg-blue-600 hover:bg-blue-700","inline-block rounded px-2 py-1 text-xs font-normal text-white mr-1 mb-1"])},[e("button",{onClick:h=>H(a),disabled:r(t).productos.filter(h=>h.producto_id===a).length>0},"Agregar",8,yt)],2)])]))),128))])])])])])])]),_:1})]))}};export{It as default};
